version: 2.0
jobs:
  build_1:
    docker:
      - image: "debian:stretch"
    environment:
      SIMH_CHECKOUT: "9711fc017be7614a96ebe3759d779ab7de59bb96"
    steps:
      - checkout
      - run:  apt-get update -myq && apt-get install -my git make gcc libncurses-dev autoconf libsdl2-dev libpng-dev libpcap-dev libvdeplug-dev
      - run:
          name: build
          command: ./script try "${SIMH_CHECKOUT}"
          no_output_timeout: 10m
          timeout: 62m
      - store_artifacts:
          path: out
  build_2:
    docker:
      - image: "debian:jessie"
    environment:
      SIMH_CHECKOUT: "9711fc017be7614a96ebe3759d779ab7de59bb96"
    steps:
      - checkout
      - run:  apt-get update -myq && apt-get install -my git make gcc libncurses-dev autoconf libsdl2-dev libpng-dev libpcap-dev libvdeplug-dev
      - run:
          name: build
          command: ./script try "${SIMH_CHECKOUT}"
          no_output_timeout: 10m
          timeout: 62m
      - store_artifacts:
          path: out
workflows:
  version: 2
  build:
    jobs:
      - build_1
      - build_2
